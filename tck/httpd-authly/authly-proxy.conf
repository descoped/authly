<VirtualHost *:8443>
    ServerName localhost
    ErrorLog /dev/stderr
    CustomLog /dev/stdout combined
    
    SSLEngine on
    SSLProtocol +TLSv1.2 +TLSv1.3
    SSLCertificateFile /usr/local/apache2/conf/ssl/server.crt
    SSLCertificateKeyFile /usr/local/apache2/conf/ssl/server.key
    
    # Set forwarded headers to indicate HTTPS
    ProxyPreserveHost on
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Host "localhost:8002"
    RequestHeader set X-Forwarded-Port "8002"
    
    # Proxy to Authly container (using Docker DNS)
    # When running in Docker network, this will resolve to the Authly container
    # When accessed externally, clients use https://localhost:8443
    ProxyPass "/" "http://host.docker.internal:8000/"
    ProxyPassReverse "/" "http://host.docker.internal:8000/"
    
    <Location "/">
        Require all granted
    </Location>
</VirtualHost>